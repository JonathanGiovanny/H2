<?xml version="1.0" encoding="UTF-8"?>
<changelog xmlns="http://www.liquigraph.org/schema/1.0/liquigraph.xsd">
    <changeset id="CREATE_PRIVILEGES" author="jonathan.camargo">
        <query>CREATE (p:Privilege {name:'READ_H', description:'Query the H elements and increase clicks'})</query>
        <query>CREATE (p:Privilege {name:'MODIFY_H', description:'Modify the H elements'})</query>
        <query>CREATE (p:Privilege {name:'DELETE_H', description:'Delete an H elements'})</query>
        <query>CREATE (p:Privilege {name:'FILTER_H', description:'Filter to be applied on the main list which includes tags and types returning an H element'})</query>
        <query>CREATE (p:Privilege {name:'READ_TAGS', description:'Query the Tags info'})</query>
        <query>CREATE (p:Privilege {name:'MODIFY_TAGS', description:'Modify the Tags elements'})</query>
        <query>CREATE (p:Privilege {name:'DELETE_TAGS', description:'Delete Tags'})</query>
        <query>CREATE (p:Privilege {name:'READ_TYPES', description:'Query the Types info'})</query>
        <query>CREATE (p:Privilege {name:'MODIFY_TYPES', description:'Modify the Types elements'})</query>
        <query>CREATE (p:Privilege {name:'DELETE_TYPES', description:'Delete types'})</query>
    </changeset>

    <changeset id="CREATE_SEC_PRIVILEGES" author="jonathan.camargo">
        <query>CREATE (p:Privilege {name:'READ_USERS', description:'Query all users'})</query>
        <query>CREATE (p:Privilege {name:'READ_ROLES', description:'Query the roles and its privileges'})</query>
        <query>CREATE (p:Privilege {name:'MODIFY_ROLES', description:'Modify a ROLE privileges'})</query>
    </changeset>

    <changeset id="CREATE_ROLES" author="jonathan.camargo">
        <query>CREATE (r:Role {name:'ROLE_USER'})</query>
        <query>MATCH (p:Privilege {name: 'READ_H'}), (r:Role {name: 'ROLE_USER'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'FILTER_H'}), (r:Role {name: 'ROLE_USER'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>

        <query>CREATE (r:Role {name:'ROLE_EDITOR'})</query>
        <query>MATCH (p:Privilege {name: 'READ_H'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'MODIFY_H'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'FILTER_H'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'READ_TAGS'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'MODIFY_TAGS'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'READ_TYPES'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
        <query>MATCH (p:Privilege {name: 'MODIFY_TYPES'}), (r:Role {name: 'ROLE_EDITOR'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>

        <query>CREATE (r:Role {name:'ROLE_ADMIN'})</query>
        <query>MATCH (p:Privilege), (r:Role {name: 'ROLE_ADMIN'}) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
    </changeset>

    <changeset id="CREATE_USERS" author="jonathan.camargo">
        <query>CREATE (u:User {username:'admin',
        						password:'$2a$12$BDkDyb4OqEkiVh0o8.RliO2D7NKwrKyHByNNBUzW.WJE7H47MPnxm',
        						email:'jongiocam@gmail.com',
        						status: 'A'})</query>
        <query>MATCH (u: User {username: 'admin'}), (r:Role {name: 'ROLE_ADMIN'}) CREATE (u) -[:HAS]-> (r)</query>
    </changeset>

	<changeset id="REMOVE_USER_READ_H_PRIV" author="jonathan.camargo">
		<query>MATCH (:Role {name:'ROLE_USER'})-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ_H'}) DELETE r</query>
	</changeset>

	<changeset id="GROUP_ALL_READS_IN_ONE_PRIVILEGE" author="jonathan.camargo">
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ_H'}) DELETE r</query>
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'FILTER_H'}) DELETE r</query>
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ_TAGS'}) DELETE r</query>
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ_TYPES'}) DELETE r</query>

		<query>MATCH (p:Privilege {name: 'READ_H'}) DELETE p</query>
		<query>MATCH (p:Privilege {name: 'FILTER_H'}) DELETE p</query>
		<query>MATCH (p:Privilege {name: 'READ_TAGS'}) DELETE p</query>
		<query>MATCH (p:Privilege {name: 'READ_TYPES'}) DELETE p</query>

        <query>CREATE (p:Privilege {name:'READ', description:'Query from all the tables'})</query>

        <query>MATCH (p:Privilege {name:'READ'}), (r:Role) CREATE (r) -[:HAS_ACCESS_TO {order: 0}]-> (p)</query>
	</changeset>

	<changeset id="DELETE_READ_PRIVILEGE" author="jonathan.camargo">
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ'}) DELETE r</query>

		<query>MATCH (p:Privilege {name: 'READ'}) DELETE p</query>
	</changeset>

	<changeset id="DELETE_SEC_PRIVILEGES" author="jonathan.camargo">
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ_USERS'}) DELETE r</query>
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'READ_ROLES'}) DELETE r</query>
		<query>MATCH (:Role)-[r:HAS_ACCESS_TO]->(:Privilege {name: 'MODIFY_ROLES'}) DELETE r</query>

		<query>MATCH (p:Privilege {name: 'READ_USERS'}) DELETE p</query>
		<query>MATCH (p:Privilege {name: 'READ_ROLES'}) DELETE p</query>
		<query>MATCH (p:Privilege {name: 'MODIFY_ROLES'}) DELETE p</query>
	</changeset>
	
	<changeset id="UPDATE_ADMIN_PASSWORD" author="jonathan.camargo">
		<query>MATCH (u:User {username:'admin'}) SET u.password='$2a$12$BDkDyb4OqEkiVh0o8.RliO2D7NKwrKyHByNNBUzW.WJE7H47MPnxm'</query>
	</changeset>
</changelog>